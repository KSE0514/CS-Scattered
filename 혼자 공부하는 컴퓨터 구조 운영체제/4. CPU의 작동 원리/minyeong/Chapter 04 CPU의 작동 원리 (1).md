# Chapter 04. CPU의 작동 원리

- [Chapter 04. CPU의 작동 원리](#chapter-04-cpu의-작동-원리)
- [04-1. ALU와 제어장치](#04-1-alu와-제어장치)
  - [ALU](#alu)
  - [제어 장치](#제어-장치)
- [04-2. 레지스터](#04-2-레지스터)
  - [레지스터 종류와 역할](#레지스터-종류와-역할)
  - [**특정 레지스터를 이용한 주소 지정 방식**](#특정-레지스터를-이용한-주소-지정-방식)
- [Q\&A](#qa)

# 04-1. ALU와 제어장치

## ALU

![Untitled](./Chapter%2004%20CPU의%20작동%20원리%20img/Untitled.png)

- ALU가 **받아들이는** 정보
    - **피연산자** : 레지스터
    - **제어 신호**(수행할 연산 알려줌) : 제어 장치
    
- ALU가 **내보내는** 정보
    - **연산한 결과값** → 일시적으로 레지스터에 저장
    - **플래그**
    
    > **플래그(flag)**
    > 
    > - 연산 결과에 대한 추가적인 상태 정보
    > 
    >  ![Untitled](./Chapter%2004%20CPU의%20작동%20원리%20img/Untitled%201.png)
    > 
    >   - 오버플로우(overflow) : 연산 결과가 연산 결과를 담을 레지스터보다 큰 상황
    > 
    > - **플래그 레지스터** : 플래그 값들을 저장하는 레지스터

## 제어 장치

- 제어 신호 내보내고, 명령어 해석하는 장치
    - 제어 신호 : 컴퓨터 부품들을 관리하고 작동시키기 위한 일종의 전기 신호

![Untitled](./Chapter%2004%20CPU의%20작동%20원리%20img/Untitled%202.png)

- 제어 장치가 **받아들이는** 정보
    - **클럭 신호**
        - 클럭(clock) : 컴퓨터의 모든 부품을 일사불란하게 움직일 수 있게 하는 시간 단위
        - 클럭이라는 박자에 맞춰 작동할 뿐, 한 박자 마다 작동하는 것 아님
    - **현재 수행할 명령어**
        - 명령어 레지스터 : CPU가 해석해야 할 명령어 저장된 레지스터
        - 해석해야 할 명령어 받아들이고 해석한 뒤, 제어 신호 발생시켜 수행해야 할 내용 알려줌
    - **플래그**
        - 플래그 레지스터 속 플래그 값 참고하여 제어 신호 발생
    - **제어 신호**
        - 제어 버스(시스템 버스)를 통해 외부로부터 전달된 제어 신호

- 제어 장치가 **내보내는** 정보
    - **제어 신호**
        - 제어 버스(시스템 버스)를 통해 CPU 내부와 외부로 전달하는 제어 신호
            - CPU 내부 → ALU, 레지스터
            - CPU 외부 → 메모리, 입출력장치

# 04-2. 레지스터

## 레지스터 종류와 역할

- **프로그램 카운터 (PC : Program Counter)**
    - 명령어 포인터 (IP : Instruction Pointer)
    - 메모리에서 가져올 명령어의 주소 저장
    - 지속적으로 증가하며 계속 다음 명령어 읽어 들일 준비 함
    - CPU가 메모리 속 프로그램 순차적으로 실행할  수 있는 이유
        - **참고 : 순차적인 실행 흐름이 끊기는 이유**
            - JUMP, CONDITIONAL JUMP, CALL, RET와 같이 특정 메모리 주소로 실행 흐름을 이동하는 명령어는 프로그램 카운터에 변경된 주소 저장됨
            - 인터럽트 발생
- **명령어 레지스터 (IR : Instruction Register)**
    - 해석할 명령어를 저장하는 레지스터
- **메모리 주소 레지스터 (MAR : Memory Address Register)**
    - 메모리의 **주소**를 저장하는 레지스터
    - CPU가 읽고자 하는 주소 값을 **주소 버스**로 보낼 때 메모리 주소 레지스터 거침
- **메모리 버퍼 레지스터  (MBR : Memory Buffer Register)**
    - 메모리 데이터 레지스터 (MDR : Memory Data Register)
    - 메모리와 **주고 받을 값(데이터와 명령어)**를 저장하는 레지스터
    - 주고 받을 값은 **데이터 버스**로 보냄
- **범용 레지스터 (general purpose register)**
    - 일반적인 상황에서 자유롭게 사용할 수 있는 레지스터
    - 데이터와 주소 모두 저장 가능
- **플래그 레지스터 (flag register)**
    - 연산결과 또는 CPU 상태에 대한 부가적인 정보 저장하는 레지스터
    

## **특정 레지스터를 이용한 주소 지정 방식**

1. **스택 주소 지정 방식**
    
    ![Untitled](./Chapter%2004%20CPU의%20작동%20원리%20img/Untitled%203.png)
    
    - 스택과 스택 포인터를 이용한 주소 지정 방식
    - **스택 포인터 (stack pointer) : 스택에 마지막으로 저장한 값의 위치를 저장하는 레지스터**
    - 스택 영역 : 메모리 안에 스택처럼 사용할 영역
    
2. **변위 주소 지정 방식**
    
    ![Untitled](./Chapter%2004%20CPU의%20작동%20원리%20img/Untitled%204.png)
    
    - 오퍼랜드 필드 값(변위)과 특정 레지스터의 값을 더하여 유효 주소를 얻어내는 주소 지정 방식
    - 명령어 : 연산 코드 필드 + 레지스터 필드+ 오퍼랜드 필드
    - **상대 주소 지정 방식 (relative addressing mode)**
        - **오퍼랜드(읽으려는 명령어)와 프로그램 카운터의 값**을 더해 유효 주소를 얻는 방식
        
        ![Untitled](./Chapter%2004%20CPU의%20작동%20원리%20img/Untitled%205.png)
        
        - 분기하여 특정 주소의 코드 실행할 때 사용
    - **베이스 레지스터 (base-register addressing mode)**
        - **오퍼랜드와 베이스 레지스터의 값**을 더해 유효 주소를 얻는 방식
            - 오퍼랜드 : 기준 주소로부터 떨어진 거리
            - 베이스 레지스터 : 기준 주소
            
            ![Untitled](./Chapter%2004%20CPU의%20작동%20원리%20img/Untitled%206.png)
            

# Q&A

1. **ALU가 받아들이는 정보와 내보내는 정보를 말하고,  연산한 결과값을 메모리가 아닌 레지스터에 저장하는 이유를 설명하시오.**
2. **제어 장치가 받아들이는 정보와 내보내는 정보를 말하시오.**
3. **레지스터 종류 8가지가 무엇인지 말하고, 각 레지스터의 역할에 대해 간략히 설명하시오.**

- **1번 답**
    
    ALU가 받아들이는 정보는 피연산자와 제어신호이고, 내보내는 정보는 연산한 결과값과 플래그 입니다. 이때, 연산한 결과값은 메모리가 아닌  레지스터에 저장하게 되는데, 그 이유는 CPU의 접근 속도를 비교해 봤을 때 레지스터에 접근하는 속도가 훨씬 빠르기 때문입니다. 만일 결과값을 메모리에 저장하게 된다면 CPU는 메모리에 자주 접근하게 되고, 프로그램 실행 속도를 늦출 수 있습니다.
    
- **2번 답**
    
    제어  장치란 제어 신호를 내보내고 명령어를 해석하는 장치입니다.
    
    제어 장치가 받아들이는 정보는 클럭, 현재 수행할 명령어, 플래그, 제어 신호가 있습니다. 클럭은 컴퓨터의 부품들을 움직일 수 있게 하는 시간 단위이며, 현재 수행해야 할 명령어는 명령어 레지스터로부터 받아들입니다. 플래그는 연산 결과에 대한 추가적인 상태 정보를 의미하며, 플래그 레지스터로부터 받아들이고, 제어 신호는 제어 버스를 통해 외부로부터 전달된 제어 신호를 의미합니다.
    
    제어 장치가 내보내는 정보는 제어 신호가 있습니다. 제어 버스를 통해 제어 신호를 CPU 내부와 외부로 전달하는데, CPU 내부로는 ALU, 레지스터, CPU 외부로는 메모리, 입출력 장치로 전달하게 됩니다. 
    
- **3번 답**
    
    레지스터의 종류로는 프로그램 카운터, 명령어 레지스터, 메모리 주소 레지스터, 메모리 버퍼 레지스터, 범용 레지스터, 플래그 레지스터, 스택 포인터, 베이스 레지스터가 있습니다.
    
    프로그램 카운터는 메모리에서 가져올 명령어의 주소, 명령어 레지스터는 해석할 명령어를 저장합니다. 메모리 주소 레지스터는 메모리의 주소, 메모리 버퍼 레지스터는 메모리와 주고 받을 데이터를 저장합니다. 범용 레지스터는 데이터와 주소를 모두 저장하고, 플래그 레지스터는 연산 결과 혹은 CPU 상태에 대한 부가 정보를 저장합니다. 스택 포인터는 스택 최상단의 위치를 저장하고, 베이스 레지스터에 저장된 주소는 기준 주소로서의 역할을 합니다.