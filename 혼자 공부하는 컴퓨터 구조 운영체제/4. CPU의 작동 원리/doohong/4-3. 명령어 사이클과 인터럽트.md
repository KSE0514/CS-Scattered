 # 혼자 공부하는 컴퓨터 구조 운영체제 
- [혼자 공부하는 컴퓨터 구조 운영체제](#혼자-공부하는-컴퓨터-구조-운영체제)
  - [4-3. 명령어 사이클과 인터럽트](#4-3-명령어-사이클과-인터럽트)
    - [명령어 사이클](#명령어-사이클)
    - [인터럽트](#인터럽트)
    - [하드웨어 인터럽트](#하드웨어-인터럽트)
      - [하드웨어 인터럽트 처리 순서](#하드웨어-인터럽트-처리-순서)
      - [하드웨어 인터럽트 관련 개념](#하드웨어-인터럽트-관련-개념)
  - [예외의 종류](#예외의-종류)
  - [Q\&A](#qa)
    - [Q1. 명령어 사이클은 무엇이며 어떻게 구성되어있는가?](#q1-명령어-사이클은-무엇이며-어떻게-구성되어있는가)
    - [Q2. 인터럽트와 인터럽트 종류를 설명하시오](#q2-인터럽트와-인터럽트-종류를-설명하시오)
    - [Q3. 하드웨어 인터럽트 처리 순서를 설명하시오.](#q3-하드웨어-인터럽트-처리-순서를-설명하시오)

## 4-3. 명령어 사이클과 인터럽트
- 명령어 사이클 : CPU는 하나의 명령어를 처리하는 과정에 정해진 흐름을 반복하며 명령어를 처리, 하나의 명령어를 처리하는 정형화된 흐름
- 인터럽트 : 정해진 흐름에 따라 명령어를 처리해나가지만 간혹 이 흐름이 끊어지는 상황이 발생

### 명령어 사이클
- 명령어 사이클 : 프로그램은 수많은 명령어로 이루어져있고, CPU는 이 명령어들을 하나씩 실행, 프로그램 속 명령어들은 일정한 주기로 반복되며 실행됨    
  1. 인출 사이클 : 메모리에 있는 명령어를 CPU로 가져오는 단계
  2. 실행 사이클 : CPU로 가져온 명령어를 실행하는 단계   
   (제어장치가 명령어 레지스터에 담긴 값을 해석, 제어 신호를 발생시키는 단계)  
  3. 간접 사이클 : 유효 주소의 주소를 명시하는 경우 명령어를 실행하기 위해 메모리 접근을 한 번 더 해야함
   => 프로그램 속 각각의 명령어들은 명령어 사이클이 반복되며 실행됨

### 인터럽트
- 인터럽트 : CPU가 수행 중인 작업을 방해하는 신호, 이로 인해 작업이 잠시 중단될 수 있음
  1. 동기 인터럽트 : CPU에 의해 발생하는 인터럽트
    - CPU가 명령어들을 수행하다가 예상치 못한 상황에 마주쳤을 때
    - CPU가 실행하는 프로그래밍 상의 오류와 같은 예외적인 상황에 마주쳤을 때 발생하는 인터럽트  
    => ***예외*** 라고 부름
  2. 비동기 인터럽트 : 주로 입출력장치에 의해 발생하는 인터럽트
    - 예 : CPU가 프린터와 같은 입출력 장치에 입출력 작업을 부탁하면 작업을 끝낸 입출력장치가 CPU에 완료 알림 (인터럽트)를 보냄
    - 예 : 키보드, 마우스와 같은 입출력장치가 어떠한 입력을 받아들였을 때 이를 처리하기 위해 CPU에 입력 알림 (인터럽트)를 보냄
    => ***하드웨어 인터럽트*** 라고 부름  

### 하드웨어 인터럽트
- 하드웨어 인터럽트 : 알림과 같은 인터럽트, CPU는 입출력 작업 도중 효율적으로 명령어를 처리하기 위해 알림과 같은 하드웨서 인터럽트를 사용
- 입출력 작업 중에도 CPU로 하여금 효율적으로 명령어를 처리할 수 있게 함

#### 하드웨어 인터럽트 처리 순서
1. 입출력 장치는 CPU에 ***인터럽트 요청 신호***를 보냄
   - CPU에게 인터럽트 하기 전 지금 끼어들어도 되냐고 물어보는 단계
2. CPU는 실행 사이클이 끝나고 명령어를 인출하기 전 항상 인터럽트 여부를 확인함
3. CPU는 인터럽트 요청을 확인하고 ***인터럽트 플래그***를 통해 현재 인터럽트를 받아들일 수 있는지 여부를 확인함
   - 인터럽트 요청을 수용하기 위해서는 플래그 레지스터의 '인터럽트 플래그'가 활성화되어 있어야 함 => 인터럽트를 받아들일지, 무시할지 결정하는 플래그
   - 인터럽트 플래그가 불가능으로 설정되어있는 경우 인터럽트 요청(maskable interrupt) 신호 무시
   - 무시할 수 없는 하드웨어 인터럽트 존재(non maskable interrupt) => 가장 먼저 처리해야하는 인터럽트로 정전이나 하드웨어 고장으로 인한 인터럽트가 이에 해당됨
4. 인터럽트를 받아들일 수 있다면 CPU는 지금까지의 작업을 백업함
   - 인터럽트 요청을 받기 전까지 CPU에서 수행하던 일을 인터럽트 서비스 루틴이 끝나면 다시 돌아와서 수행해야 함
   - 프로그램 카운터 값 등 현재 프로그램을 재개하기 위한 내용을 스택에 백업
5. CPU는 ***인터럽트 벡터***를 참조하여 인터럽트 서비스 루틴을 실행함
    - 인터럽트 서비스 루틴 : 인터럽트를 처리하기 위한 프로그램
      - 인터럽트 핸들러라고도 부름
      - 인터럽트가 발생했을 때 해당 인터럽트를 어떻게 처리하고 작동해야 할지에 대한 정보로 이루어진 프로그램
      - CPU가 인터럽트를 처리한다 = 인터럽트 서비스 루틴을 실행하고 본래 수행하던 작업으로 다시 돌아온다
      - 정상적으로 작업 진행 => 인터럽트 발생 => 인터럽트 서비스 루틴으로 점프 => 인터럽트 서비스 루틴 실행 => 기존 작업으로 점프 => 기존 작업 수행 재개
    - 인터럽트 벡터 : 인터럽트 서비스 루틴을 식별하기 위한 정보
      - 인터럽트 벡터를 알면 인터럽트 서비스 루틴의 시작 주소를 알 수 있음 => 인터럽트 서비스 루틴을 처음부터 실행 가능
6. 인터럽트 서비스 루틴 실행이 끝나면 4에서 백업해 둔 작업을 복구하여 실행을 재개함
   - 스택에 백업해둔 값을 다시 불러와 이전까지 수행하던 작업을 재개

![!\[alt text\](image.png)](<하드웨어 인터럽트 처리 순서.png>)

#### 하드웨어 인터럽트 관련 개념
- 인터럽트 요청신호: CPU의 작업을 방해하는 인터럽트에 대한 요청
- 인터럽트 플래그: 인터럽트 요청 신호를 받아들일지 무시할지를 결정하는 비트
- 인터럽트 벡터: 인터럽트 서비스 루틴의 시작주소를 포함하는 인터럽트 서비스 루틴의 식별정보 
- 인터럽트 서비스 루틴: 인터럽트를 처리하는 프로그램

## 예외의 종류
![!\[alt text\](image.png)](<예외의 종류.png>)
- 예외가 발생하면 CPU는 하던 일을 중단하고 예외를 처리하고 되돌아와서 본래 하던 작업을 실행
- 폴트(fault) : 예외가 발생한 명령어부터 실행 
- 트랩(trap): 예외가 발생한 명령어의 다음부터 실행
  - 주로 디버깅할 때 사용
- 중단 : CPU가 실행 중인 프로그램을 강제로 중단시킬 수 밖에 없는 심각한 오류를 발견했을 때 발생하는 예외
- 소프트웨어 인터럽트 : 시스템 호출이 발생했을 때


## Q&A
### Q1. 명령어 사이클은 무엇이며 어떻게 구성되어있는가?
A1. 명령어 사이클은 하나의 명령어가 처리되는 주기로 인출, 실행, 간접, 인터럽트 사이클로 구성되어있습니다.

### Q2. 인터럽트와 인터럽트 종류를 설명하시오
A2. 인터럽트란 CPU의 정상적인 작업을 방해하는 신호입니다. 인터럽트의 종류에는 프로그래밍 상 오류를 만나 발생하는 인터럽트인 예외와 입출력 장치에 의해 나타나는 알림과 같은 하드웨어적 인터럽트가 있습니다.

### Q3. 하드웨어 인터럽트 처리 순서를 설명하시오.
A3. 입출력장치가 CPU에 인터럽트 요청 신호를 보내면 CPU가 실행 사이클이 끝나고 명령어를 인출하기 전 인터럽트 여부를 확인합니다.  

CPU는 인터럽트 요청을 확인하고 인터럽트 플래그를 통해 현재 인터럽트를 받아들일 수 있는지 여부를 확인합니다.  

인터럽트를 받아들일 수 있다면 CPU는 지금까지의 작업을 백업하고 인터럽트 벡터를 참조하여 인터럽트 서비스 루틴을 실행합니다.  

인터럽트 서비스 루틴 실행이 끝나면 백업해둔 작업을 복구하여 실행을 재개합니다.