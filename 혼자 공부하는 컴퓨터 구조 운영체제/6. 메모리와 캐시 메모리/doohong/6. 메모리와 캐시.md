# 6. 메모리와 캐시 메모리
- [6. 메모리와 캐시 메모리](#6-메모리와-캐시-메모리)
  - [6-1. RAM의 특징과 종류](#6-1-ram의-특징과-종류)
    - [RAM의 특징](#ram의-특징)
    - [RAM의 용량과 성능](#ram의-용량과-성능)
    - [RAM의 종류](#ram의-종류)
  - [6-2. 메모리의 주소 공간](#6-2-메모리의-주소-공간)
    - [물리 주소와 논리 주소](#물리-주소와-논리-주소)
      - [논리 주소 =\> 물리 주소 변환 (메모리 관리 장치)](#논리-주소--물리-주소-변환-메모리-관리-장치)
    - [메모리 보호 기법](#메모리-보호-기법)
  - [6-3. 캐시 메모리](#6-3-캐시-메모리)
    - [저장 장치 계층 구조](#저장-장치-계층-구조)
    - [캐시 메모리](#캐시-메모리)
    - [참조 지역성 원리](#참조-지역성-원리)
  - [Q\&A](#qa)
    - [Q1. RAM의 종류에 대해 설명하시오.](#q1-ram의-종류에-대해-설명하시오)
    - [Q2. 논리 주소를 물리 주소로 변환하는 방법과 메모리 보호기법에 대해 설명하시오.](#q2-논리-주소를-물리-주소로-변환하는-방법과-메모리-보호기법에-대해-설명하시오)
    - [Q3. 저장 장치 계층 구조와 참조 지역성의 원리를 설명하시오.](#q3-저장-장치-계층-구조와-참조-지역성의-원리를-설명하시오)

  

## 6-1. RAM의 특징과 종류
- 주기억장치 : RAM(메모리), ROM

### RAM의 특징
- RAM에는 실행할 프로그램의 명령어와 데이터가 저장됨
- RAM은 휘발성으로 전원을 끄면 저장된 명령어와 데이터가 모두 날라감
  => 휘발성 저장 장치 (volatile memory)
- 비휘발성 저장 장치 (non-volatile memory)의 예시 : 하드 디스크, SSD, CD-ROM, USB 메모리와 같은 보조기억장치
  => 보조기억장치는 전원을 꺼도 내용을 유지하지만, CPU는 보조기억장치에 직접 접근하지 못함
- 보조기억장치인 비휘발성 저장 장치에는 '보관할 대상'을 저장
- 휘발성 저장 장치인 RAM에는 '실행할 대상'을 저장
- CPU가 실행하고 싶은 프로그램이 보조기억장치에 있다면 이를 RAM으로 복사하여 저장한 뒤 실행함

### RAM의 용량과 성능
- CPU가 실행하고 싶은 프로그램이 보조기억장치에 있다면 RAM으로 가져오게 되는데 만약 RAM의 용량이 작다면 계속 보조기억장치에서 맞춰서 가져와야 함
- 반면 보조기억장치의 용량이 크다면 많은 데이터를 보조기억장치에서 가져와 미리 RAM에 저장해놓을 수 있음

### RAM의 종류
1. DRAM (Dynamic RAM)
- 저장된 데이터가 동적으로 변하는(사라지는) RAM을 의미함
- 시간이 지나면 저장된 데이터가 점차 사라지는 RAM
- DRAM의 데이터 소멸을 막기 위해서는 일정 주기로 데이터를 재활성화(다시 저장)해야 함
- 일반적으로 우리가 메모리로 사용하는 RAM = DRAM
  - 소비 전력이 비교적 낮음
  - 저렴함
  - 집적도가 높아 더 작고 빽빽하게 만들 수 있어서 대용량으로 설계하기 용이

<br>

2. SRAM (Static RAM)
- 저장된 데이터가 변하지 않는 정적인 RAM
- 시간이 지나도 저장된 데이터가 사라지지 않음
- 주기적으로 데이터를 재활성화할 필요가 없음
- SRAM이 일반적으로 DRAM보다 속도가 빠름
- 비휘발성 메모리인 것은 여전히 맞아 전원이 공급되지 않으면 저장된 내용이 날라감
- 일반적인 RAM으로 사용되지 않음
  - 집접도가 낮음
  - 소비전력이 큼
  - 가격이 더 비쌈
- 메모리가 아닌 대용량으로 만들어질 필요는 없지만 빨라야 하는 저장 장치에 사용   
  => 예 : 캐시 메모리

![!\[alt text\](image.png)](<DRAM vs SRAM.png>)

<br>

3. SDRAM (Synchronous Dynamic RAM)
- 클럭 신호와 동기화된, 발전된 형태의 DRAM
- 클럭 타이밍에 맞춰 CPU와 정보를 주고 받을 수 있음
- SDRAM은 클럭에 맞춰 동작하며 CPU와 정보를 주고 받을 수 있는 DRAM

<br>

- 3-1.  SDR SDRAM (Single Data Rate SDRAM) : 한 클럭당 하나의 데이터를 주고 받을 수 있는 SDRAM

<br>

- 3-2. DDR SDRAM (Double Data Rate SDRAM)
  - 최근 흔히 사용되는 RAM
  - 대역폭을 넓혀 속도를 빠르게 만든 SDRAM
    - 대역폭이란? 데이터를 주고 받는 길이의 너비
  - SDRAM은 한 클럭에 한번씩 CPU와 데이터를 주고 받을 수 있지만 DDR SDRAM은 두 배의 대역폭으로 한 클럭당 두번씩 CPU와 데이터를 주고 받을 수 있음
  - 전송 속도가 두배 정도 빠름
  - SDR SDRAM (Single Data Rate SDRAM) : 한 클럭당 하나의 데이터를 주고 받을 수 있는 SDRAM

- 3-3.DDR3 SDRAM, DDR4 SDRAM
  - DDR3 SDRAM : 대역폭이 8배 더 넓은 SDRAM
  - DDR4 SDRAM : 대역폭이 16배 더 넓은 대역폭

## 6-2. 메모리의 주소 공간
- 메모리에 저장된 정보의 위치는 주소로 나타낼 수 있음
  1. 물리 주소
   - 메모리 하드웨어가 사용하는 주소
  2. 논리 주소
   - CPU와 실행 중인 프로그램이 사용하는 주소

### 물리 주소와 논리 주소
- 메모리에는 새롭게 실행되는 프로그램이 시시때때로 적재되고, 실행이 끝난 프로그램은 삭제됨
- 주소에는 메모리가 사용하는 물리주소와 CPU와 실행 중인 프로그램이 사용하는 논리 주소가 있다.

<br>

1. 물리 주소 : 실제로 저장된 하드웨어 상의 주소, 메모리가 사용하는 주소
2. 논리 주소 : 실행 중인 프로그램 각각에게 부여된 0번지부터 시작되는 주소, CPU와 실행 중인 프로그램이 사용하는 주소

- 현재 다른 프로그램들이 메모리 몇번지에 저장되어 있는지 물리 주소를 알 필요가 없음
- 새로운 프로그램이 언제든지 적재 될 수 있고 실행되지 않는 프로그램은 언제든 메모리에서 사라질 수 있음

- 각 프로그램들은 물리 주소 외 0번지부터 시작되는 자신만의 논리 주소를 가지고 있음
- CPU는 논리 주소를 받아들이고, 해석하고 연산함

#### 논리 주소 => 물리 주소 변환 (메모리 관리 장치)
- 논리 주소와 물리 주소 간의 변환은 CPU와 주소 버스 사이에 위치한 메모리 관리 장치(MMU:Memory Management Unit)라는 하드웨어에 의해 수행
![!\[alt text\](image-1.png)](<메모리 관리 장치.png>)

- CPU가 발생시킨 논리 주소에 베이스 레지스터 값을 더하여 논리 주소를 물리 주소로 변환
- 베이스 레지스터는 프로그램의 가장 작은 물리 주소, 즉 프로그램의 첫 물리 주소를 저장
- 논리 주소는 프로그램의 시작점으로부터 떨어진 거리

### 메모리 보호 기법
- 한계 레지스터 : 다른 프로그램의 영역을 침범할 수 있는 명령어는 위험하기 때문에 논리 주소 범위를 벗어나는 명령어 실행을 방지하고 실행 중인 프로그램이 다른 프로그램에 영향 받지 않도록 보호함
  => 주소의 최대 크기를 저장  
  - 프로그램의 물리 주소 범위: 베이스 레지스터 이상, 베이스 레지스터 값 + 한계 레지스터 값 미만

- CPU는 메모리에 접근하기 전에 접근하고자 하는 논리 주소가 한계 레지스터보다 작은지를 항상 검사함
- 한계 레지스터보다 더 높은 논리 주소에 접근하려고 하면 인터럽트(트랩)을 발생시켜 실행을 중단


## 6-3. 캐시 메모리
- CPU가 메모리에 접근하는 시간이 CPU의 연산 속도보다 느림
- 연산을 아무리 빨리 해도 메모리에 접근하는 시간이 느리면 CPU의 빠른 연산 속도가 의미가 없어짐
  => 이를 극복하기 위해 `캐시메모리`라는 저장 장치를 사용함

### 저장 장치 계층 구조
- 저장 장치의 명제
  1. CPU와 가까운 저장 장치는 빠르고, 멀리 있는 저장 장치는 느리다.
  2. 속도가 빠른 저장 장치는 저장 용량이 작고, 가격이 비싸다.
   
  - 레지스터, 메모리(RAM), USB 메모리의 예시
    - CPU와 가장 가까운 레지스터는 일반적으로 RAM보다 용량은 작지만 압도적으로 바르고 가격이 비쌈
    - USB 메모리보다 CPU에 더 가까운 RAM은 접근 시간이 훨씬 더 빠르지만 같은 용량이라 할지라도 가격은 더 비쌈
    => 낮은 가격대의 대용량 저장 장치를 원하면 느린 속도는 감수해야함
    => 빠른 메모리를 원한다면 작은 용량과 비싼 가격은 감수해야 함
- CPU와 얼마나 가까운가를 기반으로 `저장 장치 계층 구조 (memory hierarchy)`를 나타낼 수 있음

![!\[alt text\](image.png)](저장장치계층구조.png)
- 위 계층으로 올라갈수록 CPU와 가깝고 용량은 작지만 빠르고 비싼 저장 장치
- 아래 계층으로 내려갈수록 CPU와 멀고 용량은 크지만 느리며 저렴한 저장 장치

### 캐시 메모리
- 캐시 메모리 : CPU와 메모리 사이에 위치, 레지스터보다 용량이 크고 메모리보다 빠른 SRAM 기반의 저장 장치
  - CPU의 연산 속도와 메모리 접근 속도의 차이를 조금이나마 줄이기 위해 탄생
  - 메모리에서 CPU가 사용할 일부 데이터를 미리 캐시 메모리로 가지고 와 활용하는 것
- 캐시메모리는 가까운 편의점과 비슷하고 메모리는 먼 대형 마트와 비슷하다고 생각하면 됨
- 캐시 메모리를 포함한 `저장 장치 계층 구조`
![!\[alt text\](image.png)](<캐시메모리 포함 저장장치계층구조.png>)

- 캐시 메모리들은 CPU와 가까운 순서대로 계층을 구성
  - 코어와 가까운 순서로 `L1 => L2 => L3`로 나타냄 (Level+num)
  - 위 순서대로 용량이 커지고 순서가 느려짐
  - 위 순서대로 캐시에 해당 데이터가 있는지를 확인함
  - L1, L2 캐시는 코어마다 고유한 캐시 메모리가 할당
  - L3는 여러 코어가 공유하는 형태로 사용됨
![](<캐시 메모리 할당 형태.png>)

- 분리형 캐시
![!\[alt text\](image.png)](<분리형 캐시.png>)

### 참조 지역성 원리
- 보조기억장치는 전원이 꺼져도 기억할 대상을 저장
- 메모리는 실행 중인 대상을 저장
- 캐시 메모리는 CPU가 사용할 법한 대상을 예측하여 저장  
  => 이 때 예측이 맞아 캐시 메모리 내 데이터가 CPU에 활용될 경우 `캐시 히트`라고 함  
  => 예측이 틀려 메모리에서 필요한 데이터를 직접 가져와야 하는 경우를 `캐시 미스`라고 함
- 캐시 적중률 계산법
  - 캐시 히트 횟수 / (캐시 히트 횧수 + 캐시 미스 횟수)

<br>

- 캐시 메모리의 이점을 살리기 위해서 CPU가 사용할 법한 데이터를 제대로 예측해서 캐시 적중률을 높여야 함
  - CPU가 사용할법한 데이터를 어떻게 알까?
- 캐시 메모리가 메모리로부터 데이터를 가져오는 원칙 : `참조 지역성의 원리`
  1. CPU는 최근에 접근했던 메모리 공간에 다시 접근하려는 경향이 있음
    - CPU는 변수가 저장된 메모리 공간을 언제든 다시 참조할 수 있음
    - CPU는 최근에 접근했던 변수가 저장된 메모리 공간을 여러번 다시 접근할 수 있음
    => 최근에 접근했던 메모리 공간에 다시 접근하려는 경향 : `시간 지역성`
  2. CPU는 접근한 메모리 공간 근처를 접근하려는 경향이 있음
    - CPU가 실행하려는 프로그램은 보통 관련 데이터들끼리 한데 모여있음
    - 하나의 프로그램 내에서도 관련 있는 데이터들은 모여서 저장됨
    - 만약 사용자가 입력을 한다면 입력 기능이 모여있는 공간을 집중적으로 접근
    - 접근한 메모리 공간 근처를 접근하려는 경향 : `공간 지역성`


## Q&A
### Q1. RAM의 종류에 대해 설명하시오.
RAM의 종류에는 대표적으로 4가지가 있습니다. 먼저 DRAM은 저장된 데이터가 시간이 지나면 소멸하는 RAM으로 소비전력이 낮고 저렴하며 집적도가 높아 대용량으로 설계하기 쉬워 자주 사용됩니다. 

다음으로 SRAM은 저장된 데이터가 변하지 않지만 집적도가 낮고 소비전력이 크며 가격이 비싸 대용량일 필요는 없지만 빨라야 하는 캐시 메모리에서 사용됩니다.

세번째로 SDRAM은 클럭 신호와 동기화된 형태의 DRAM으로 클럭에 맞춰 동작합니다.

SDRAM의 종류 중 SDR SDRAM은 한 클럭 당 하나의 데이터를 주고 받을 수 있으며, DDR SDRAM은 한 클럭 당 두번씩 CPU와 데이터를 주고 받을 수 있습니다.

### Q2. 논리 주소를 물리 주소로 변환하는 방법과 메모리 보호기법에 대해 설명하시오.
논리 주소는 CPU와 실행 중인 프로그램이 사용되는 주소이며 물리 주소는 실제로 저장된 하드웨어 상의 주소이다. 논리 주소와 물리 주소 간의 변환은 CPU와 주소 버스 사이에 위치한 메모리 관리 장치라는 하드웨어에 의해 수행된다.

CPU가 발생시킨 논리 주소에 베이스 레지스터 값을 더하여 논리 주소를 물리 주소로 변환시킨다.

이 때 논리 주소 범위를 벗어나는 명령어 실행을 방지하고 실행 중인 프로그램이 다른 프로그램에 영향을 받지 않도록 보호하기 위하여 주소의 최대 크기를 저장해놓는 것을 메모리 보호 기법이라고 한다.

### Q3. 저장 장치 계층 구조와 참조 지역성의 원리를 설명하시오.
저장 장치 계층 구조는 CPU와 가까운 저장 장치는 빠르고 저장 용량이 작고 가격이 비싸며, 먼 저장 장치는 느리고 용량이 크고 가격이 싸다는 명제를 가지고 CPU와 얼마나 가까운가를 기반으로 나타낸 것이다.

참조 지역성의 원리는 캐시 메모리의 경우 CPU가 사용할법한 대상을 예측하여 저장하는데 이 적중률을 높이기 위한 방법이다.

참조 지역성의 원리란 최근 접근했던 메모리 공간에 다시 접근하려는 경향을 나타내며 공간 지역성의 원리는 접근한 메모리 공간 근처를 접근하려는 경향이다.
